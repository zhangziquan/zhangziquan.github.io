<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <link rel="canonical" href="http://ziquanzhang.ink/2018/09/12/Cocos2dx/">
    
    
    <title>[Cocos2dx]  | Legend never dies | zhangzq&#39;s index</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Cocos2dx">
    <meta name="description" content="现代操作系统应用开发实验报告​                                                          姓名： 张子权_ ​                                                          学号：16340296 ​">
<meta name="keywords" content="Cocos2dx">
<meta property="og:type" content="article">
<meta property="og:title" content="[Cocos2dx] ">
<meta property="og:url" content="http://ziquanzhang.ink/2018/09/12/Cocos2dx/index.html">
<meta property="og:site_name" content="Legend never dies">
<meta property="og:description" content="现代操作系统应用开发实验报告​                                                          姓名： 张子权_ ​                                                          学号：16340296 ​">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://images/pasted-1.png/">
<meta property="og:image" content="http://images/pasted-2.png/">
<meta property="og:image" content="http://images/pasted-3.png/">
<meta property="og:image" content="http://images/pasted-4.png/">
<meta property="og:image" content="http://images/pasted-5.png/">
<meta property="og:image" content="http://images/pasted-6.png/">
<meta property="og:image" content="http://images/pasted-7.png/">
<meta property="og:image" content="http://images/pasted-8.png/">
<meta property="og:image" content="http://images/pasted-9.png/">
<meta property="og:image" content="http://images/pasted-10.png/">
<meta property="og:image" content="http://images/pasted-11.png/">
<meta property="og:image" content="http://images/pasted-12.png/">
<meta property="og:image" content="http://images/pasted-13.png/">
<meta property="og:image" content="http://images/pasted-14.png/">
<meta property="og:updated_time" content="2018-09-12T11:09:30.631Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[Cocos2dx] ">
<meta name="twitter:description" content="现代操作系统应用开发实验报告​                                                          姓名： 张子权_ ​                                                          学号：16340296 ​">
<meta name="twitter:image" content="http://images/pasted-1.png/">
    
        <link rel="alternate" type="application/atom+xml" title="Legend never dies" href="/atom.xml">
    
    <link rel="shortcut icon" href="/Linken's Sphere.png">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/Nyan Cat.gif">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">zhang ziquan</h5>
          <a href="mailto:1417580438@qq.com" title="1417580438@qq.com" class="mail">1417580438@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zhangziquan" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://steamcommunity.com/id/zhangziquan/" target="_blank" >
                <i class="icon icon-lg icon-steam"></i>
                Steam
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/game"  >
                <i class="icon icon-lg icon-gamepad"></i>
                stupid game
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">[Cocos2dx] </div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">[Cocos2dx] </h1>
        <h5 class="subtitle">
            
                <time datetime="2018-09-12T08:33:00.000Z" itemprop="datePublished" class="page-time">
  2018-09-12
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MOSAD/">MOSAD</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#现代操作系统应用开发实验报告"><span class="post-toc-number">1.</span> <span class="post-toc-text">现代操作系统应用开发实验报告</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一、参考资料"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">一、参考资料</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、实验要求"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">二、实验要求</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Lucia2-0"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">Lucia2.0</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Thunder"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">Thunder</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HitBrick"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">HitBrick</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、实验步骤"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">三、实验步骤</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Lucia2-0-1"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">Lucia2.0</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Thunder-1"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">Thunder</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HitBrick-1"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">HitBrick</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、实验演示"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">四、实验演示</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#更多操作"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">更多操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#五、亮点与改进"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">五、亮点与改进</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#六、遇到的问题"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">六、遇到的问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#七、思考与总结"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">七、思考与总结</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Cocos2dx"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">[Cocos2dx] </h1>
        <div class="post-meta">
            <time class="post-time" title="2018-09-12 16:33:00" datetime="2018-09-12T08:33:00.000Z"  itemprop="datePublished">2018-09-12</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MOSAD/">MOSAD</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="现代操作系统应用开发实验报告"><a href="#现代操作系统应用开发实验报告" class="headerlink" title="现代操作系统应用开发实验报告"></a>现代操作系统应用开发实验报告</h1><p>​                                                          <strong>姓名： <u>张子权</u>_</strong></p>
<p>​                                                          <strong>学号：<u>16340296</u></strong></p>
<p>​                                                          <strong>实验名称： <u>homework5</u></strong></p>
<h2 id="一、参考资料"><a href="#一、参考资料" class="headerlink" title="一、参考资料"></a>一、参考资料</h2><p><a href="http://www.cocos.com/docs/native/v3/particle-system/zh.html" target="_blank" rel="noopener">http://www.cocos.com/docs/native/v3/particle-system/zh.html</a></p>
<p><a href="http://www.cocos2d-x.org/docs/programmers-guide/physics/index.html" target="_blank" rel="noopener">http://www.cocos2d-x.org/docs/programmers-guide/physics/index.html</a> </p>
<p><a href="http://blog.csdn.net/fansongy/article/details/14142323" target="_blank" rel="noopener">http://blog.csdn.net/fansongy/article/details/14142323</a> </p>
<p><a href="http://www.cocos2d-x.org/docs/api-ref/cplusplus/v3x/d2/d8a/classcocos2d_1_1_physics_joint.html" target="_blank" rel="noopener">http://www.cocos2d-x.org/docs/api-ref/cplusplus/v3x/d2/d8a/classcocos2d_1_1_physics_joint.html</a></p>
<p><a href="https://blog.csdn.net/zy19940906/article/details/52025460" target="_blank" rel="noopener">https://blog.csdn.net/zy19940906/article/details/52025460</a></p>
<h2 id="二、实验要求"><a href="#二、实验要求" class="headerlink" title="二、实验要求"></a>二、实验要求</h2><h3 id="Lucia2-0"><a href="#Lucia2-0" class="headerlink" title="Lucia2.0"></a>Lucia2.0</h3><p>第十三周为在上一周的基础上添加怪物，场景。（主要学习怪物工厂机制，数据结构以及本地存储）</p>
<p><strong>要求</strong>：1.产生怪物并向玩家靠近，怪物攻击角色掉血，角色血量归零则死亡。</p>
<p>2.角色可攻击怪物，攻击中后回血，且记录怪物数量（建立数据库）。</p>
<p>3.使用Tilemap建立游戏地图。</p>
<h3 id="Thunder"><a href="#Thunder" class="headerlink" title="Thunder"></a>Thunder</h3><p>第十四周为射击游戏。（主要学习事件处理和添加音效、音乐）</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-1.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure>
<p><strong>要求</strong>：1.使用键盘移动player，触摸为子弹发射。（附加鼠标移动）</p>
<p>2.player发射子弹击毁陨石/陨石碰撞飞船爆炸。（产生音效）</p>
<p>3.显示当前页面的子弹和陨石数，添加背景音乐。</p>
<h3 id="HitBrick"><a href="#HitBrick" class="headerlink" title="HitBrick"></a>HitBrick</h3><p>第十五周设计打砖头游戏。（学习cocos2dx物理引擎与粒子系统）</p>
<p><strong>要求</strong>：1.通过键盘移动板子左右，并在开始时用关节固定球和板子。</p>
<p>2.顶部生成小砖块，给板子、球、以及砖块设置物理属性。（给球等等添加粒子效果）</p>
<p>3.添加碰撞事件监听器，砖球碰撞消去砖头，球地碰撞游戏结束。</p>
<h2 id="三、实验步骤"><a href="#三、实验步骤" class="headerlink" title="三、实验步骤"></a>三、实验步骤</h2><h3 id="Lucia2-0-1"><a href="#Lucia2-0-1" class="headerlink" title="Lucia2.0"></a><strong>Lucia2.0</strong></h3><p>1.创建怪物工厂这个类，来统一生成怪物，移动怪物，判断怪物的碰撞以及移除怪物。使用一个向量表来存储已生成的怪物。实例化工厂到地图中，使用调度器来定时调用<code>Factory::createMonster()</code>,定时生成怪物。在此同时也调用<code>Factory::moveMonster()</code>使得怪物向角色移动：</p>
<pre><code>
for (auto i : monster) {
    Vec2 Pos = i->getPosition();
    Vec2 dir = playerPos - Pos;
    dir.normalize();
    i->runAction(MoveBy::create(time, dir * 30));
}
</code></pre>

<p>当怪物碰撞到角色时，调用函数减少玩家生命值，并将怪物移除：</p>
<pre><code>
Sprite* collision = fac->collider(player->getBoundingBox());
if (collision != NULL)
{
    auto hppercent = pT->getPercentage();
    changeHp(false);
    fac->removeMonster(collision);
}
</code></pre>

<p>当玩家生命值归零调用gameover()函数.</p>
<pre><code>
//判断是否死亡
if (pT->getPercentage() == 0 && !isDead)
{
    player->stopAllActions();
    isDead = true;
    //播放死亡动画
    auto animate = Animate::create(AnimationCache::getInstance()->getAnimation("dead"));
    player->runAction(animate);
    //保存数据，一个是本地临时存储，一个是数据库。
    UserDefault::sharedUserDefault()->setIntegerForKey("Score", dscore);
    saveData();
}
</code></pre>

<p>2.玩家移动时，设置向左和向右的时候有一个标志，当向左时，设置player-&gt;setFlipX(true);，将图片X镜像，调反过来。向右时恢复原图。玩家攻击怪物回血与怪物碰撞玩家相似，只不过是以玩家为基点，扩大碰撞范围，在此范围内怪物将被攻击到并移除。同时玩家回血。（因可能同时攻击多个怪物，所以使用while循环）。</p>
<pre><code>
            while (true)
            {
                Sprite* collision = fac->collider(attackRect);
                if (collision == NULL)
                    break;
                changeHp(true);
                fac->removeMonster(collision);
                dscore++;
            }
</code></pre>

<p>3.创建tilemap则<code>TMXTiledMap* tmx = TMXTiledMap::create(&quot;mymap.tmx&quot;);</code>即可插入地图，调整其位置覆盖满整个游戏。至于数据库存储，使用cocos2dx自带的sqlite3，打开使用<code>sqlite3_open(&quot;score.db&quot;, &amp;pDB);</code>，创建Score表<code>sqlite3_exec(pDB, &quot;create table myTable( ID integer primary key autoincrement, score integer ) &quot;</code>，用数据库操作保存数据。</p>
<h3 id="Thunder-1"><a href="#Thunder-1" class="headerlink" title="Thunder"></a><strong>Thunder</strong></h3><p>1.利用键盘移动Player主要添加键盘事件监听器，当发生按键时，记录所按键位，并在调度器中根据键位来调用移动函数<code>Thunder::movePlane(char c)</code>，触摸同理，当发生触摸事件，即返回isClick = true，调用<code>Thunder::fire()</code>，来进行发射子弹。通过鼠标控制移动则在onTouchMoved中设置当鼠标移动时，飞船跟随，并且isClick = false，不发射：</p>
<pre><code>
isClick = false;
if (isvalidLoc(touch->getLocation()))
{
    player->setPosition(Vec2(touch->getLocation().x, player->getPosition().y));
}
</code></pre>

<p>2.自定义子弹打中陨石碰撞事件，通过调度器分发事件，先遍历所有陨石，每个陨石遍历所有子弹，即可避免子弹击中的先后问题，当子弹距离陨石一定范围，移除子弹、陨石，播放爆炸动画/音效：（陨石击中飞船同理，此时额外调用游戏结束的函数）这里的播放使用了sequence + callfunc的方法，在播放完动画后移除陨石。</p>
<pre><code>
            Sprite* temp = (*it1);
            (*it1)->runAction(
                Sequence::create(
                    Animate::create(
                        Animation::createWithSpriteFrames(explore, 0.05f, 1)
                    ),
                    CallFunc::create([temp] {
                        temp->removeFromParentAndCleanup(true);
                    }),
                    nullptr
                )
            );
            //播放音效
            SimpleAudioEngine::getInstance()->playEffect("/music/explore.wav", false);
            (*it2)->removeFromParentAndCleanup(true);
            bullets.erase(it2);
</code></pre>

<p>3.预加载要播放的音乐，初始化时，播放背景音乐，至于显示页面的子弹数和陨石数，只要在移除的时候正确从两个list中移除，读取list其中元素个数即可正确显示。</p>
<h3 id="HitBrick-1"><a href="#HitBrick-1" class="headerlink" title="HitBrick"></a><strong>HitBrick</strong></h3><p>1.打砖块游戏，板子移动和week14同理，主要为关节的固定，首先要给板和球体设置刚体，一个为box一个为circle，并设好弹性系数，摩擦系数，密度。且球为动态刚体，再使用PhysicsJointPin将球固定在板子上，根据PhysicsJointPin的介绍可知其为一个节点使连接的刚体能够自由地围绕其转动，所以将这个节点为两个刚体的锚点的中点，因此在设置时，另一个以板子的锚点为坐标的点应向上偏移到球体的锚点处，即可将Pin固定在球体中心，同时使这个关节内的刚体不能相互碰撞。</p>
<pre><code>
joint1 = PhysicsJointPin::construct(
    player->getPhysicsBody(), ball->getPhysicsBody(),
    Vec2(0,40), Vec2(0,0));
joint1->setCollisionEnable(false);
</code></pre>

<p>2.计算好顶部的长宽和砖块的长宽，循环生成三层的小砖块，并设置物理属性，弹性系数为1，使得完全弹回。并设置碰撞掩码，使砖块相互之间不会触发碰撞事件。</p>
<pre><code>
    boxbody->setCategoryBitmask(0xFFFF0000);
    boxbody->setCollisionBitmask(0xFFFFFFFF);
    boxbody->setContactTestBitmask(0x0000FFFF);
</code></pre>

<p>另外顺便给球添加一下粒子效果：设置了一个火焰效果，在球体中心并进行放大。</p>
<pre><code>
ParticleFire* fireworks = ParticleFire::create();
fireworks->setPosition(Vec2(250, 250));
fireworks->setScale(3);
ball->addChild(fireworks);
</code></pre>

<p>3.添加碰撞事件。发生碰撞时调用：</p>
<pre><code>
if (c1->getBody()->getTag() == 1 || c2->getBody()->getTag() == 1)
{
    GameOver();
}
</code></pre>

<p>另外还有一个蓄力操作，当按下SP，通过调度器不断增加速度，当SP松开，将速度赋给球。</p>
<pre><code>
    spHolded = false;
    if (joint1 != NULL)
    {
        joint1->removeFormWorld();
        joint1 = NULL;
        if (spFactor > visibleSize.height * 1.1)
        {
            spFactor = visibleSize.height * 1.1;
        }
        ball->getPhysicsBody()->setVelocity(Vect(0, spFactor));
    }
</code></pre>

<h2 id="四、实验演示"><a href="#四、实验演示" class="headerlink" title="四、实验演示"></a>四、实验演示</h2><p><strong>Lucia2.0：</strong></p>
<p>Lucia初始画面<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-2.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>碰撞掉血<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-3.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>攻击回血<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-4.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>死亡画面<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-5.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>记录上一次的分数<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-6.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p><strong>Thunder：</strong></p>
<p>主界面<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-7.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>Thunder射击<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-8.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>Thunder爆炸<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-9.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>Thunder结束1<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-10.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>Thunder结束2<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-11.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p><strong>HitBrick：</strong></p>
<p>HitBrick主界面<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-12.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>HitBrick碰撞<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-13.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<p>HitBrick结束<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\\images\pasted-14.png\" alt="upload successful" title="">
                </div>
                <div class="image-caption">upload successful</div>
            </figure></p>
<h3 id="更多操作"><a href="#更多操作" class="headerlink" title="更多操作"></a>更多操作</h3><p>更多操作可能上传到<a href="https://space.bilibili.com/33699187/#/中" target="_blank" rel="noopener">https://space.bilibili.com/33699187/#/中</a></p>
<h2 id="五、亮点与改进"><a href="#五、亮点与改进" class="headerlink" title="五、亮点与改进"></a>五、亮点与改进</h2><p><strong>Lucia2.0：</strong>建立了一个比较可靠的数据库，能记录最高分，上一次获得的分数（强退时则不会记录），以及本次的分数，并且每次的分数均有保留。一次攻击能攻击多个敌人。</p>
<p><strong>Thunder：</strong>当陨石出了边界后，会从列表和画面中移除。当游戏结束后，自动在右下角生成一个重新游戏的按钮，便于重新开始游戏。</p>
<p><strong>HitBrick：</strong>1.酷炫的火焰效果。2.合理的难度设计。3.舒适的操作手感。4.不错的游戏反馈。</p>
<h2 id="六、遇到的问题"><a href="#六、遇到的问题" class="headerlink" title="六、遇到的问题"></a>六、遇到的问题</h2><p><strong>Lucia2.0：</strong></p>
<p>1.怪物工厂判断碰撞时，只会返回其中一个怪物，根据列表顺序来看，是先生成的怪物，所以如果要进行AOE的话，要把该区域的所有怪物都取得，所以在这里我使用了while，直到无怪物返回为止。</p>
<p>2.数据库不知为何cocos2dx库里自带的sqlite3无法使用，只好上网自己下了头文件和编译文件。其数据库操作都很常规。很轻松就能解决。</p>
<p><strong>Thunder：</strong></p>
<p>1.飞船射击游戏<del>雷电</del>，在设计飞船发射子弹时，一开始是让子弹每一段时间进行移动，到边界后逐个移除，经同学提醒后了解到可以使用Sequence + callFuc 的组合，一开始就让子弹飞向边界，到达后自动调用函数进行移除。（使用回调的方法）</p>
<p>2.另外一个比较重要的问题就是子弹撞在陨石后，碰撞事件使用了两层循环遍历，使用erase时，要注意把返回值传递给变量以取得下一个元素（子弹/陨石），且这个时候变量不能自增，因为已经找到了下一个元素。一开始没有这么做导致出现了迭代器为空，以及遍历错误。</p>
<p>3.另外在添加那个重新开始的按钮时，如果先添加后停掉所有事件监听器，这个按钮也是没有用的，这也是为什么我在游戏结束后，再让那个按钮出现的原因，后添加使得按钮能够正常工作。</p>
<p><strong>HitBrick：</strong></p>
<p>1.定义关节一直找不到PhysicsJointPin的定义，后来认真看了介绍应该是相当于二叉树的那种旋转pin，两个刚体围绕着这个节点可以自由旋转，有点像双星系统。因此把板的刚体的点向上偏移到球的那个点，两点重合为一点，这样使得板子围绕球可转（但板子是静态刚体，因此不可转），球自转，达到固定球的效果。</p>
<p>2.摩擦系数过大会导致损失能量，速度会越来越慢，因此我把球的摩擦力调小，其它的也调到极小，这样球就不会旋转，并且依靠摩擦而转向、发生旋转时损失的能量也很小。</p>
<p>3.在设置板的移动时，通过添加速度和改变位置是不一样的，添加速度会使上面的球也有一个速度（惯性），所以发射时会有一个平移的速度，但是直接改变位置就没有这种效果了。</p>
<h2 id="七、思考与总结"><a href="#七、思考与总结" class="headerlink" title="七、思考与总结"></a>七、思考与总结</h2><p>这三次的作业总的来说还是比较简单的，第一个作业让我了解到了有怪物工厂这种机制，方便进行管理和创建，这样要比把怪物分成很多个更加方便。</p>
<p>之后两个作业更加深入地了解到Cocos2dx这个游戏引擎，当做到与物理引擎相关的作业时，发现有了物理引擎方便很多，再也不用之前那种反物理的移动方式了。。。</p>
<p>另外其物理引擎感觉和其它游戏引擎差不多，都是用刚体这种东西来控制的。游戏用的最多的都是调度器，因为调度器能够时刻监控游戏的碰撞等事件的发生，然后马上作出一些反应出来，Cocos2dx这个物理引擎给我们提供了一个物理环境，使我们的精灵在其中按照设定好的物理属性运作，而相关的事件还是要由我们自己来写。而在处理一些事件时，Sequence + callFuc这种回调方法很有用，相当于异步的效果，使得我们在一些行为的开始后不用去关心如何去结束它。</p>
<p>游戏的难度设定还是挺麻烦的，要给人一种可以玩下去，但又不太简单的样子，有时候加入一些运气成分进去，可以让玩家更加投入到其中，像一些rogue like 游戏，可能这是一种赌徒心态吧。。。。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2018-09-12T11:09:30.631Z" itemprop="dateUpdated">2018-09-12 19:09:30</time>
</span><br>


        
        <a href="/2018/09/12/Cocos2dx/" target="_blank" rel="external">http://ziquanzhang.ink/2018/09/12/Cocos2dx/</a>
        
    </div>
    
    <footer>
        <a href="http://ziquanzhang.ink">
            <img src="/img/Nyan Cat.gif" alt="zhang ziquan">
            zhang ziquan
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocos2dx/">Cocos2dx</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ziquanzhang.ink/2018/09/12/Cocos2dx/&title=《[Cocos2dx] 》 — Legend never dies&pic=http://ziquanzhang.ink/img/Nyan Cat.gif" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ziquanzhang.ink/2018/09/12/Cocos2dx/&title=《[Cocos2dx] 》 — Legend never dies&source=张子权的博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ziquanzhang.ink/2018/09/12/Cocos2dx/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《[Cocos2dx] 》 — Legend never dies&url=http://ziquanzhang.ink/2018/09/12/Cocos2dx/&via=http://ziquanzhang.ink" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ziquanzhang.ink/2018/09/12/Cocos2dx/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/09/09/Leetcode-75-Sort-Colors/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">[Leetcode] 75.Sort Colors</h4>
      </a>
    </div>
  
</nav>



    








<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
			id: "Wed Sep 12 2018 16:33:00 GMT+0800",
            owner: 'zhangziquan',
            repo: 'blog-comment',
            oauth: {
                client_id: '5e5c57c64db494a7f6c0',
                client_secret: 'faed34b1a876acd24b48dc022083d85113a730a2',
            },
        })
        gitment.render('comments')
    </script>
</section>










</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        唯一指定二维码
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>zhang ziquan &copy; 2018</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">粤ICP备17120669号-1</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ziquanzhang.ink/2018/09/12/Cocos2dx/&title=《[Cocos2dx] 》 — Legend never dies&pic=http://ziquanzhang.ink/img/Nyan Cat.gif" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ziquanzhang.ink/2018/09/12/Cocos2dx/&title=《[Cocos2dx] 》 — Legend never dies&source=张子权的博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ziquanzhang.ink/2018/09/12/Cocos2dx/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《[Cocos2dx] 》 — Legend never dies&url=http://ziquanzhang.ink/2018/09/12/Cocos2dx/&via=http://ziquanzhang.ink" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ziquanzhang.ink/2018/09/12/Cocos2dx/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLElEQVR42u3aS3KDQAwFQN//0mSTRapi8JMGUkH0rCh/8DQLWRrp9YrX9mP9fiV5t/crJy8MDIzbMrbDdczIqdVX8r1hYGA8h7EXwZLrvVtXw27ysHZfx8DAwAi2mATT/M4YGBgY6wE3+bE8mB4/CAwMDIw8dFaLzONN5OH45FocAwPjhoz81P3vry/pb2BgYNyKsRVXL6VLgm9vP9/fxcDAGM1YKUHzRmZ1qKK5HwwMjKGMKw7u81KzN8Dx5pMYGBijGWelelc0BsrpJgYGxlBGb2AiP8qvnozlaeLu/wYGBsY4Rp6Q5ZurwvKg/+FdDAyM0YxeQdtrRq6MZURpKAYGxjhGPp61HljzAFo+7MPAwHgMIw+yOX79LDB6KBgYGKMZvcSu2kJYaXDmrVMMDIypjPxgK28DrBz9F0YrqkUsBgbGzRm9grNK6rELwxYYGBhDGWcdhDXbjcEnC+kjBgbGUEav+FxPClfSwTd3xsDAGM2obqhaBlfDbu9QDwMD4zmMPBVrthiLB3bN9gAGBsZoxkoRu1KINvuuV8+dYWBg/HvGyshXL3An60OKiYGBMZSxFdf6t6pDHtGjwcDAGM04LWbHhWteACfXZRgGBsZtGVeEy5UEsRlwMTAwHsDIA181cufBOg/9GBgYGD3GyuhYdVcfhi0wMDAez6jWwXlRmt9ht4jFwMAYzcibAVV8bwisXABjYGCMZqyUjsfHbec2GE5oamJgYNyP8QW6GmC+F4k9OwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '一个神奇的网站';
            clearTimeout(titleTime);
        } else {
            document.title = 'zhangzq's blog';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
